<script>
  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBh5lf53YIooqzIX-b7j6FnhpXFTALqXwQ",
    authDomain: "test-22d96.firebaseapp.com",
    databaseURL: "https://test-22d96-default-rtdb.firebaseio.com",
    projectId: "test-22d96",
    storageBucket: "test-22d96.firebasestorage.app",
    messagingSenderId: "451437946308",
    appId: "1:451437946308:web:7a88331e115d447a84f091"
  };

  // Initialize Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.database();  // Access Firebase Realtime Database

  const students = ["student1", "student2", "student3", "student4", "student5", "student6"];
  const studentPassword = "student123";

  const questions = [
    { question: "1. What is the color of the sky?", options: ["Blue", "Green", "Red", "Yellow"], answer: "Blue" },
    { question: "2. How many legs does a cat have?", options: ["2", "3", "4", "5"], answer: "4" },
    { question: "3. What do we use to write?", options: ["Pen", "Spoon", "Ball", "Shoes"], answer: "Pen" },
    { question: "4. Which is a fruit?", options: ["Apple", "Car", "Chair", "Fan"], answer: "Apple" },
    { question: "5. What do we drink when we are thirsty?", options: ["Water", "Oil", "Juice", "Ink"], answer: "Water" },
    { question: "6. What is 2 + 2?", options: ["3", "4", "5", "6"], answer: "4" },
    { question: "7. Which animal barks?", options: ["Cat", "Dog", "Elephant", "Cow"], answer: "Dog" },
    { question: "8. What do we wear on our head?", options: ["Shoes", "Hat", "Gloves", "Shirt"], answer: "Hat" },
    { question: "9. What is the opposite of hot?", options: ["Warm", "Cold", "Cool", "Boiling"], answer: "Cold" },
    { question: "10. Which one can fly?", options: ["Fish", "Bird", "Dog", "Cow"], answer: "Bird" }
  ];

  let currentQuestion = 0;
  let timer;
  let timeLeft = 60;
  let score = 0;
  let currentUser = "";
  let answerTrack = [];
  const studentResults = [];

  // Login function
  function login() {
    const user = document.getElementById("username").value.trim();
    const pass = document.getElementById("password").value.trim();
    if (user === "admin" && pass === "admin123") {
      document.getElementById("login-page").classList.add("hidden");
      document.getElementById("admin-page").classList.remove("hidden");
      setTimeout(() => {
        displayResults();
        displayLeaderboard();
      }, 0);
    } else if (students.includes(user) && pass === studentPassword) {
      currentUser = user;
      score = 0;
      currentQuestion = 0;
      answerTrack = [];
      document.getElementById("login-page").classList.add("hidden");
      document.getElementById("quiz-page").classList.remove("hidden");
      showQuestion();
    } else {
      alert("Invalid credentials");
    }
  }

  function showQuestion() {
    if (currentQuestion >= questions.length) {
      alert(`Quiz Finished! Your score: ${score}/10`);
      studentResults.push({ name: currentUser, score: score, details: [...answerTrack] });
      document.getElementById("quiz-page").classList.add("hidden");
      document.getElementById("login-page").classList.remove("hidden");
      displayResults();
      displayLeaderboard();
      return;
    }
    const q = questions[currentQuestion];
    document.getElementById("question-box").innerText = q.question;
    const optionsDiv = document.getElementById("options");
    optionsDiv.innerHTML = "";
    q.options.forEach((opt, index) => {
      const label = document.createElement("label");
      label.innerHTML = `<input type='radio' name='option' value='${opt}' onchange='nextQuestion()'> ${opt}`;
      optionsDiv.appendChild(label);
    });
    timeLeft = 60;
    document.getElementById("timer").innerText = timeLeft;
    clearInterval(timer);
    timer = setInterval(() => {
      timeLeft--;
      document.getElementById("timer").innerText = timeLeft;
      if (timeLeft <= 0) {
        clearInterval(timer);
        nextQuestion();
      }
    }, 1000);
  }

  function nextQuestion() {
    clearInterval(timer);
    const selected = document.querySelector("input[name='option']:checked");
    const correct = questions[currentQuestion].answer;
    const chosen = selected ? selected.value : "No Answer";
    const isCorrect = chosen === correct;
    if (isCorrect) score++;
    answerTrack.push({ q: questions[currentQuestion].question, chosen: chosen, correct: correct, result: isCorrect });
    currentQuestion++;
    setTimeout(showQuestion, 500);
  }

  function displayResults() {
    const resultsList = document.getElementById("results");
    resultsList.innerHTML = "";
    studentResults.forEach(result => {
      const li = document.createElement("li");
      li.innerHTML = `<strong>${result.name}</strong> - Score: ${result.score}/10<ul>` +
        result.details.map(d => `<li>${d.q} <span class='${d.result ? "correct" : "incorrect"}'>(${d.chosen})</span></li>`).join("") +
        `</ul>`;
      resultsList.appendChild(li);
    });
  }

  function displayLeaderboard() {
    const leaderboard = document.getElementById("leaderboard");
    const sorted = [...studentResults].sort((a, b) => b.score - a.score);
    leaderboard.innerHTML = `<ul>` +
      sorted.map((r, i) => `<li>${r.name} - ${r.score}/10</li>`).join("") +
      `</ul>`;
  }
</script>
